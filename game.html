<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="game-container">
    <div class="container">
      <h1>Stats</h1>
      <div class="status-bar">
        <div class="status-bar-label">HP:</div>
        <div class="status-bar-container">
          <div id="hpBar" class="status-bar-fill" style="width: 100%;"></div>
          <div id="hpText" class="status-bar-text">0 / 100</div> <!-- Moved the HP text here -->
        </div>
      </div>
      <div class="status-bar">
        <div class="status-bar-label">MP:</div>
        <div class="status-bar-container">
          <div id="mpBar" class="status-bar-fill" style="width: 100%;"></div>
          <div id="mpText" class="status-bar-text">0 / 100</div> <!-- Moved the MP text here -->
        </div>
      </div>
      <div class="button-container">
        <button id="increaseHP" onmousedown="handleContinuousChange('hp', true)" ontouchstart="handleContinuousChange('hp', true)" onmouseup="stopContinuousChange()" ontouchend="stopContinuousChange()">HP+</button>
        <button id="decreaseHP" onmousedown="handleContinuousChange('hp', false)" ontouchstart="handleContinuousChange('hp', false)" onmouseup="stopContinuousChange()" ontouchend="stopContinuousChange()">HP-</button>
        <button id="increaseMP" onmousedown="handleContinuousChange('mp', true)" ontouchstart="handleContinuousChange('mp', true)" onmouseup="stopContinuousChange()" ontouchend="stopContinuousChange()">MP+</button>
        <button id="decreaseMP" onmousedown="handleContinuousChange('mp', false)" ontouchstart="handleContinuousChange('mp', false)" onmouseup="stopContinuousChange()" ontouchend="stopContinuousChange()">MP-</button>
      </div>
    </div>
    <div class="dice-container-wrapper">
      <div class="dice-container dice-3">
        <div id="dice3" class="dice">3</div>
      </div>
      <div class="dice-container">
        <div id="dice6" class="dice">6</div>
      </div>
      <div class="dice-container dice-20">
        <div id="dice20" class="dice">20</div>
      </div>
    </div>
  </div>

  <audio id="diceRollSound" src="dice_rolling.mp3"></audio>

  <script>
    // Retrieve maxHP and maxMP from the URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const maxHP = parseInt(urlParams.get("maxHP"));
    const maxMP = parseInt(urlParams.get("maxMP"));

    // Initialize current HP and MP to their maximum values
    let currentHP = maxHP;
    let currentMP = maxMP;

    // Function to update the HP and MP bars
    function updateBars() {
      const hpBarFill = document.getElementById("hpBar");
      const mpBarFill = document.getElementById("mpBar");
      const hpPercentage = (currentHP / maxHP) * 100;
      const mpPercentage = (currentMP / maxMP) * 100;
      hpBarFill.style.width = hpPercentage + "%";
      mpBarFill.style.width = mpPercentage + "%";
    }

    // Function to update the HP and MP text elements
    function updateTexts() {
      const hpText = document.getElementById("hpText");
      const mpText = document.getElementById("mpText");
      hpText.textContent = `${currentHP} / ${maxHP}`;
      mpText.textContent = `${currentMP} / ${maxMP}`;
    }

    // Function to handle mouse sliding on bars
    function handleBarSlide(event) {
      const bar = event.target;
      const barRect = bar.getBoundingClientRect();
      const offsetX = event.clientX - barRect.left;
      const percentage = Math.min(100, Math.max(0, (offsetX / barRect.width) * 100));
      
      if (bar.id === "hpBar") {
        currentHP = Math.floor((percentage / 100) * maxHP);
      } else if (bar.id === "mpBar") {
        currentMP = Math.floor((percentage / 100) * maxMP);
      }

      updateBars();
      updateTexts();
    }

    // Add event listener to enable sliding behavior
    document.getElementById("hpBar").addEventListener("mousedown", function (event) {
      handleBarSlide(event);
      document.addEventListener("mousemove", handleBarSlide);
    });

    document.getElementById("mpBar").addEventListener("mousedown", function (event) {
      handleBarSlide(event);
      document.addEventListener("mousemove", handleBarSlide);
    });

    document.addEventListener("mouseup", function () {
      document.removeEventListener("mousemove", handleBarSlide);
    });

    let continuousChangeIntervalId;

    // Function to handle continuous change (called on button mousedown or touchstart)
    function handleContinuousChange(type, isIncreasing) {
      // Function to increase or decrease the value
      function changeValue() {
        if (isIncreasing) {
          if (type === "hp" && currentHP < maxHP) {
            currentHP++;
          } else if (type === "mp" && currentMP < maxMP) {
            currentMP++;
          }
        } else {
          if (type === "hp" && currentHP > 0) {
            currentHP--;
          } else if (type === "mp" && currentMP > 0) {
            currentMP--;
          }
        }
        updateBars();
        updateTexts();
      }

      // Initial call for single click
      changeValue();

      // Set the interval for continuous change after a short delay
      continuousChangeIntervalId = setInterval(function () {
        changeValue();
      }, 300); // Adjust the interval time (in milliseconds) as per your preference
    }

    // Function to stop continuous change (called on button mouseup or touchend)
    function stopContinuousChange() {
      clearInterval(continuousChangeIntervalId);
    }

    // Add event listeners to the buttons for starting continuous change
    document.getElementById("increaseHP").addEventListener("mouseleave", stopContinuousChange);
    document.getElementById("decreaseHP").addEventListener("mouseleave", stopContinuousChange);
    document.getElementById("increaseMP").addEventListener("mouseleave", stopContinuousChange);
    document.getElementById("decreaseMP").addEventListener("mouseleave", stopContinuousChange);

    // Function to simulate rolling the dice and update the number
    function rollDice(diceElement, maxNumber) {
      const randomNumber = Math.floor(Math.random() * maxNumber) + 1;
      diceElement.textContent = randomNumber;

      // Play the dice roll sound
      const diceRollSound = document.getElementById("diceRollSound");
      diceRollSound.play();
    }

    // Add click event listeners to the dice containers to roll the dice
    document.getElementById("dice6").addEventListener("click", function () {
      rollDice(this, 6);
    });

    document.getElementById("dice3").addEventListener("click", function () {
      rollDice(this, 3);
    });

    document.getElementById("dice20").addEventListener("click", function () {
      rollDice(this, 20);
    });

    // Initial update of the bars and texts
    updateBars();
    updateTexts();
  </script>
</body>
</html>
